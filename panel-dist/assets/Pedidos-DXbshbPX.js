import{f as me,J as ge,o as ve,j as e,a as Ce,b as Se,r as h,t as fe,h as Ee,n as Pe,i as Z,p as j,A as be,k as ye,B as N,V as T,F as $,H as Fe,m as g,q as v,S as ze,T as t,s as ee,K as Te,l as O,y as ke,z as Me,C as we,E as p,G as Ae,M as _e,v as Ie,w as Le,x as De}from"./index-CRkNY6ry.js";import{v as Be,C as Q,c as V,w as Re,g as qe,x as He,y as Ne,H as Oe,j as se,I as Qe,z as Ve,D as We}from"./index.esm-CzniNAqg.js";import{u as k}from"./useMutation-tt7yEThG.js";import{u as ie}from"./useQuery-B78dU_LM.js";import{S as M,a as w,b as A,c as _}from"./stat-number-Cmk69z9o.js";import{I as Ge,a as Ue}from"./input-element-D4QcLV82.js";import{I as re}from"./input-BR2M-WI7.js";import{S as I,F as C}from"./select-C8GCKjda.js";import{T as Je,a as Ke,b as ae,c as x,d as Xe,e as u}from"./tr-Cbx9FMhk.js";import{T as oe}from"./tooltip-DDxb5mqh.js";import{M as Ye,a as Ze}from"./modal-footer-B3ZHaos3.js";import{F as S}from"./form-label-DaOodn7p.js";import{T as ne}from"./textarea-p1Zsad_O.js";const te=me(function(E,m){const L=ge("Link",E),{className:P,isExternal:b,...n}=ve(E);return e.jsx(Ce.a,{target:b?"_blank":void 0,rel:b?"noopener":void 0,ref:m,className:Se("chakra-link",P),...n,__css:L})});te.displayName="Link";const $e={pendiente:"yellow",resuelto:"green"},es={baja:"green",media:"yellow",alta:"orange",urgente:"red"},js=()=>{var Y;const[f,E]=h.useState(""),[m,L]=h.useState(""),[P,b]=h.useState(""),[n,W]=h.useState(1),[y,G]=h.useState(null),[a,c]=h.useState({titulo:"",descripcion:"",contenido_solicitado:"",estado:"pendiente",prioridad:"media"}),{isOpen:le,onOpen:U,onClose:F}=fe(),l=Ee(),z=Pe(),D=Z("white","gray.700"),B=Z("gray.200","gray.600"),{data:d,isLoading:de,error:J}=ie(["pedidos",n,f,m,P],()=>j.getPedidos(n,20,f,m)),{data:o}=ie("pedidoStats",j.getPedidoStats),K=k(j.createPedido,{onSuccess:()=>{z.invalidateQueries("pedidos"),l({title:"Pedido creado",description:"El pedido ha sido creado exitosamente",status:"success"}),F(),q()},onError:s=>{var i,r;l({title:"Error",description:((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Error al crear pedido",status:"error"})}}),R=k(s=>j.updatePedido(s.id,s.pedido),{onSuccess:()=>{z.invalidateQueries("pedidos"),l({title:"Pedido actualizado",description:"El pedido ha sido actualizado exitosamente",status:"success"}),F(),q()},onError:s=>{var i,r;l({title:"Error",description:((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Error al actualizar pedido",status:"error"})}}),ce=k(j.deletePedido,{onSuccess:()=>{z.invalidateQueries("pedidos"),l({title:"Pedido eliminado",description:"El pedido ha sido eliminado exitosamente",status:"success"})},onError:s=>{var i,r;l({title:"Error",description:((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Error al eliminar pedido",status:"error"})}}),xe=k(s=>j.resolvePedido(s.id,s.aporte_id),{onSuccess:()=>{z.invalidateQueries("pedidos"),l({title:"Pedido resuelto",description:"El pedido ha sido marcado como completado",status:"success"})},onError:s=>{var i,r;l({title:"Error",description:((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Error al resolver pedido",status:"error"})}}),q=()=>{c({titulo:"",descripcion:"",contenido_solicitado:"",estado:"pendiente",prioridad:"media"}),G(null)},ue=()=>{q(),U()},he=s=>{G(s),c({titulo:s.titulo,descripcion:s.descripcion||"",contenido_solicitado:s.contenido_solicitado,estado:s.estado,prioridad:s.prioridad,grupo_id:s.grupo_id}),U()},je=s=>{s.preventDefault(),y?R.mutate({id:y.id,pedido:a}):K.mutate(a)},pe=s=>{window.confirm("¿Estás seguro de que quieres eliminar este pedido?")&&ce.mutate(s)},X=s=>{const i=window.prompt("ID del aporte relacionado (opcional):");xe.mutate({id:s,aporte_id:i?parseInt(i):void 0})},H=(s,i)=>{R.mutate({id:s,pedido:{estado:i}})};return J?e.jsxs(be,{status:"error",children:[e.jsx(ye,{}),"Error al cargar pedidos: ",J.message]}):e.jsxs(N,{children:[e.jsxs(T,{spacing:6,align:"stretch",children:[e.jsxs($,{align:"center",justify:"space-between",children:[e.jsx(Fe,{size:"lg",children:"Gestión de Pedidos"}),e.jsx(g,{leftIcon:e.jsx(Be,{}),colorScheme:"green",onClick:ue,children:"Nuevo Pedido"})]}),e.jsx(Q,{bg:D,border:"1px",borderColor:B,children:e.jsx(V,{children:e.jsxs(v,{spacing:8,justify:"center",children:[e.jsxs(M,{textAlign:"center",children:[e.jsx(w,{children:"Total Pedidos"}),e.jsx(A,{children:(o==null?void 0:o.totalPedidos)||0}),e.jsx(_,{children:"En el sistema"})]}),e.jsxs(M,{textAlign:"center",children:[e.jsx(w,{children:"Pendientes"}),e.jsx(A,{color:"yellow.500",children:(o==null?void 0:o.pedidosPendientes)||0}),e.jsx(_,{children:"Requieren atención"})]}),e.jsxs(M,{textAlign:"center",children:[e.jsx(w,{children:"En Proceso"}),e.jsx(A,{color:"blue.500",children:(o==null?void 0:o.pedidosEnProceso)||0}),e.jsx(_,{children:"En desarrollo"})]}),e.jsxs(M,{textAlign:"center",children:[e.jsx(w,{children:"Completados"}),e.jsx(A,{color:"green.500",children:(o==null?void 0:o.pedidosCompletados)||0}),e.jsx(_,{children:"Finalizados"})]})]})})}),e.jsx(Q,{bg:D,border:"1px",borderColor:B,children:e.jsx(V,{children:e.jsxs(v,{spacing:4,wrap:"wrap",children:[e.jsxs(Ge,{maxW:"300px",children:[e.jsx(Ue,{pointerEvents:"none",children:e.jsx(Re,{color:"gray.300"})}),e.jsx(re,{placeholder:"Buscar pedidos...",value:f,onChange:s=>E(s.target.value)})]}),e.jsxs(I,{placeholder:"Filtrar por estado",value:m,onChange:s=>L(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"resuelto",children:"Resuelto"})]}),e.jsxs(I,{placeholder:"Filtrar por prioridad",value:P,onChange:s=>b(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"baja",children:"Baja"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"urgente",children:"Urgente"})]})]})})}),e.jsx(Q,{bg:D,border:"1px",borderColor:B,children:e.jsxs(V,{children:[de?e.jsxs(N,{textAlign:"center",py:8,children:[e.jsx(ze,{size:"xl"}),e.jsx(t,{mt:4,children:"Cargando pedidos..."})]}):e.jsx(N,{overflowX:"auto",children:e.jsxs(Je,{variant:"simple",children:[e.jsx(Ke,{children:e.jsxs(ae,{children:[e.jsx(x,{children:"Título"}),e.jsx(x,{children:"Estado"}),e.jsx(x,{children:"Prioridad"}),e.jsx(x,{children:"Usuario"}),e.jsx(x,{children:"Aporte Relacionado"}),e.jsx(x,{children:"Fecha"}),e.jsx(x,{children:"Acciones"})]})}),e.jsx(Xe,{children:(Y=d==null?void 0:d.pedidos)==null?void 0:Y.map(s=>{var i,r;return e.jsxs(ae,{children:[e.jsx(u,{children:e.jsxs(T,{align:"start",spacing:1,children:[e.jsx(t,{fontWeight:"semibold",children:s.titulo}),s.descripcion&&e.jsx(t,{fontSize:"sm",color:"gray.500",noOfLines:2,children:s.descripcion}),e.jsxs(t,{fontSize:"xs",color:"gray.400",children:["ID: ",s.id]})]})}),e.jsx(u,{children:e.jsx(ee,{colorScheme:$e[s.estado]||"gray",variant:"subtle",children:s.estado.replace("_"," ")})}),e.jsx(u,{children:e.jsx(ee,{colorScheme:es[s.prioridad]||"gray",variant:"subtle",children:s.prioridad})}),e.jsx(u,{children:e.jsxs(v,{children:[e.jsx(Te,{size:"sm",name:(i=s.usuario)==null?void 0:i.username}),e.jsx(t,{fontSize:"sm",children:((r=s.usuario)==null?void 0:r.username)||"N/A"})]})}),e.jsx(u,{children:s.aporte?e.jsx(te,{color:"blue.500",fontSize:"sm",children:s.aporte.titulo}):e.jsx(t,{fontSize:"sm",color:"gray.500",children:"Sin aporte"})}),e.jsx(u,{children:e.jsxs(T,{align:"start",spacing:0,children:[e.jsx(t,{fontSize:"sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{fontSize:"xs",color:"gray.500",children:new Date(s.created_at).toLocaleTimeString()})]})}),e.jsx(u,{children:e.jsxs(v,{spacing:2,children:[e.jsx(oe,{label:"Ver detalles",children:e.jsx(O,{"aria-label":"Ver detalles",icon:e.jsx(qe,{}),size:"sm",variant:"ghost",colorScheme:"blue"})}),e.jsx(oe,{label:"Editar pedido",children:e.jsx(O,{"aria-label":"Editar pedido",icon:e.jsx(He,{}),size:"sm",variant:"ghost",colorScheme:"orange",onClick:()=>he(s)})}),e.jsxs(ke,{children:[e.jsx(Me,{as:O,"aria-label":"Más opciones",icon:e.jsx(Ne,{}),size:"sm",variant:"ghost"}),e.jsxs(we,{children:[s.estado==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:e.jsx(Oe,{}),onClick:()=>H(s.id,"resuelto"),children:"Marcar en proceso"}),e.jsx(p,{icon:e.jsx(se,{}),onClick:()=>X(s.id),children:"Completar"})]}),s.estado==="resuelto"&&e.jsx(p,{icon:e.jsx(se,{}),onClick:()=>X(s.id),children:"Completar"}),s.estado==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:e.jsx(Qe,{}),onClick:()=>H(s.id,"resuelto"),children:"Cancelar"}),e.jsx(p,{icon:e.jsx(Ve,{}),onClick:()=>H(s.id,"resuelto"),children:"Rechazar"})]}),e.jsx(Ae,{}),e.jsx(p,{icon:e.jsx(We,{}),color:"red.500",onClick:()=>pe(s.id),children:"Eliminar"})]})]})]})})]},s.id)})})]})}),(d==null?void 0:d.pagination)&&e.jsx($,{justify:"center",mt:6,children:e.jsxs(v,{spacing:2,children:[e.jsx(g,{size:"sm",onClick:()=>W(n-1),isDisabled:n===1,children:"Anterior"}),e.jsxs(t,{children:["Página ",n," de ",d.pagination.totalPages]}),e.jsx(g,{size:"sm",onClick:()=>W(n+1),isDisabled:n===d.pagination.totalPages,children:"Siguiente"})]})})]})})]}),e.jsxs(_e,{isOpen:le,onClose:F,size:"xl",children:[e.jsx(Ie,{}),e.jsx(Ye,{children:e.jsxs("form",{onSubmit:je,children:[e.jsx(Le,{children:y?"Editar Pedido":"Crear Nuevo Pedido"}),e.jsx(De,{children:e.jsxs(T,{spacing:4,children:[e.jsxs(C,{isRequired:!0,children:[e.jsx(S,{children:"Título"}),e.jsx(re,{value:a.titulo,onChange:s=>c({...a,titulo:s.target.value}),placeholder:"Ingresa el título del pedido"})]}),e.jsxs(C,{children:[e.jsx(S,{children:"Descripción"}),e.jsx(ne,{value:a.descripcion,onChange:s=>c({...a,descripcion:s.target.value}),placeholder:"Descripción opcional del pedido",rows:3})]}),e.jsxs(C,{isRequired:!0,children:[e.jsx(S,{children:"Contenido Solicitado"}),e.jsx(ne,{value:a.contenido_solicitado,onChange:s=>c({...a,contenido_solicitado:s.target.value}),placeholder:"Describe el contenido que necesitas",rows:5})]}),e.jsxs(C,{isRequired:!0,children:[e.jsx(S,{children:"Estado"}),e.jsxs(I,{value:a.estado,onChange:s=>c({...a,estado:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"resuelto",children:"Resuelto"})]})]}),e.jsxs(C,{isRequired:!0,children:[e.jsx(S,{children:"Prioridad"}),e.jsxs(I,{value:a.prioridad,onChange:s=>c({...a,prioridad:s.target.value}),children:[e.jsx("option",{value:"baja",children:"Baja"}),e.jsx("option",{value:"media",children:"Media"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"urgente",children:"Urgente"})]})]})]})}),e.jsxs(Ze,{children:[e.jsx(g,{variant:"ghost",mr:3,onClick:F,children:"Cancelar"}),e.jsx(g,{colorScheme:"blue",type:"submit",isLoading:K.isLoading||R.isLoading,children:y?"Actualizar":"Crear"})]})]})})]})]})};export{js as Pedidos,js as default};
//# sourceMappingURL=Pedidos-DXbshbPX.js.map
