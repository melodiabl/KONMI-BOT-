import{r as p,t as ce,h as ue,n as he,i as J,p as h,j as e,A as xe,k as je,B as z,V as A,F as X,H as pe,m,q as g,S as me,T as u,s as Z,l as T,y as ge,z as ve,C as Se,E as I,G as Ce,M as Ee,v as be,w as fe,x as Ue}from"./index-CRkNY6ry.js";import{v as we,C as D,c as k,w as ye,g as Fe,x as Me,y as ze,Z as Ae,_ as Te,D as Ie}from"./index.esm-CzniNAqg.js";import{u as b}from"./useMutation-tt7yEThG.js";import{u as K}from"./useQuery-B78dU_LM.js";import{S as B,a as _,b as L,c as q}from"./stat-number-Cmk69z9o.js";import{I as De,a as ke}from"./input-element-D4QcLV82.js";import{I as f}from"./input-BR2M-WI7.js";import{S as R,F as v}from"./select-C8GCKjda.js";import{T as Be,a as _e,b as Y,c as x,d as Le,e as j}from"./tr-Cbx9FMhk.js";import{T as $}from"./tooltip-DDxb5mqh.js";import{M as qe,a as Re}from"./modal-footer-B3ZHaos3.js";import{F as S}from"./form-label-DaOodn7p.js";const Pe={owner:"purple",admin:"red",moderador:"green",usuario:"gray"},Ne={activo:"green",inactivo:"red",suspendido:"orange"},es=()=>{var G;const[U,ee]=p.useState(""),[w,se]=p.useState(""),[l,P]=p.useState(1),[d,N]=p.useState(null),[r,c]=p.useState({username:"",password:"",roles:["usuario"],estado:"activo",wa_jid:""}),{isOpen:ae,onOpen:Q,onClose:C}=ce(),t=ue(),E=he(),y=J("white","gray.700"),F=J("gray.200","gray.600"),{data:n,isLoading:re,error:V}=K(["usuarios",l,U,w],()=>h.getUsuarios(l,20,U,w)),{data:o}=K("usuarioStats",h.getUsuarioStats),H=b(h.createUsuario,{onSuccess:()=>{E.invalidateQueries("usuarios"),t({title:"Usuario creado",description:"El usuario ha sido creado exitosamente",status:"success"}),C(),M()},onError:s=>{var a,i;t({title:"Error",description:((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Error al crear usuario",status:"error"})}}),O=b(s=>h.updateUsuario(s.id,s.user),{onSuccess:()=>{E.invalidateQueries("usuarios"),t({title:"Usuario actualizado",description:"El usuario ha sido actualizado exitosamente",status:"success"}),C(),M()},onError:s=>{var a,i;t({title:"Error",description:((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Error al actualizar usuario",status:"error"})}}),ie=b(h.deleteUsuario,{onSuccess:()=>{E.invalidateQueries("usuarios"),t({title:"Usuario eliminado",description:"El usuario ha sido eliminado exitosamente",status:"success"})},onError:s=>{var a,i;t({title:"Error",description:((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Error al eliminar usuario",status:"error"})}}),oe=b(s=>h.updateUsuarioEstado(s.id,s.estado),{onSuccess:()=>{E.invalidateQueries("usuarios"),t({title:"Estado actualizado",description:"El estado del usuario ha sido actualizado",status:"success"})},onError:s=>{var a,i;t({title:"Error",description:((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Error al actualizar estado",status:"error"})}}),M=()=>{c({username:"",password:"",roles:["usuario"],estado:"activo",wa_jid:""}),N(null)},te=()=>{M(),Q()},ne=s=>{N(s),c({username:s.username,password:"",roles:s.roles,estado:s.estado,wa_jid:s.wa_jid||""}),Q()},le=s=>{s.preventDefault(),d?O.mutate({id:d.id,user:r}):H.mutate(r)},de=s=>{window.confirm("¿Estás seguro de que quieres eliminar este usuario?")&&ie.mutate(s)},W=(s,a)=>{oe.mutate({id:s,estado:a})};return V?e.jsxs(xe,{status:"error",children:[e.jsx(je,{}),"Error al cargar usuarios: ",V.message]}):e.jsxs(z,{children:[e.jsxs(A,{spacing:6,align:"stretch",children:[e.jsxs(X,{align:"center",justify:"space-between",children:[e.jsx(pe,{size:"lg",children:"Gestión de Usuarios"}),e.jsx(m,{leftIcon:e.jsx(we,{}),colorScheme:"green",onClick:te,children:"Nuevo Usuario"})]}),e.jsx(D,{bg:y,border:"1px",borderColor:F,children:e.jsx(k,{children:e.jsxs(g,{spacing:8,justify:"center",children:[e.jsxs(B,{textAlign:"center",children:[e.jsx(_,{children:"Total Usuarios"}),e.jsx(L,{children:(o==null?void 0:o.totalUsuarios)||0}),e.jsx(q,{children:"Registrados en el sistema"})]}),e.jsxs(B,{textAlign:"center",children:[e.jsx(_,{children:"Activos"}),e.jsx(L,{color:"green.500",children:(o==null?void 0:o.usuariosActivos)||0}),e.jsx(q,{children:"Usuarios activos"})]}),e.jsxs(B,{textAlign:"center",children:[e.jsx(_,{children:"Administradores"}),e.jsx(L,{color:"red.500",children:(o==null?void 0:o.totalAdmins)||0}),e.jsx(q,{children:"Con rol admin"})]})]})})}),e.jsx(D,{bg:y,border:"1px",borderColor:F,children:e.jsx(k,{children:e.jsxs(g,{spacing:4,children:[e.jsxs(De,{maxW:"300px",children:[e.jsx(ke,{pointerEvents:"none",children:e.jsx(ye,{color:"gray.300"})}),e.jsx(f,{placeholder:"Buscar usuarios...",value:U,onChange:s=>ee(s.target.value)})]}),e.jsxs(R,{placeholder:"Filtrar por estado",value:w,onChange:s=>se(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"}),e.jsx("option",{value:"suspendido",children:"Suspendido"})]})]})})}),e.jsx(D,{bg:y,border:"1px",borderColor:F,children:e.jsxs(k,{children:[re?e.jsxs(z,{textAlign:"center",py:8,children:[e.jsx(me,{size:"xl"}),e.jsx(u,{mt:4,children:"Cargando usuarios..."})]}):e.jsx(z,{overflowX:"auto",children:e.jsxs(Be,{variant:"simple",children:[e.jsx(_e,{children:e.jsxs(Y,{children:[e.jsx(x,{children:"Usuario"}),e.jsx(x,{children:"Roles"}),e.jsx(x,{children:"Estado"}),e.jsx(x,{children:"WhatsApp"}),e.jsx(x,{children:"Fecha Creación"}),e.jsx(x,{children:"Acciones"})]})}),e.jsx(Le,{children:(G=n==null?void 0:n.usuarios)==null?void 0:G.map(s=>e.jsxs(Y,{children:[e.jsx(j,{children:e.jsxs(A,{align:"start",spacing:1,children:[e.jsx(u,{fontWeight:"semibold",children:s.username}),e.jsxs(u,{fontSize:"sm",color:"gray.500",children:["ID: ",s.id]})]})}),e.jsx(j,{children:e.jsx(g,{spacing:1,children:s.roles.map(a=>e.jsx(Z,{colorScheme:Pe[a]||"gray",variant:"subtle",children:a},a))})}),e.jsx(j,{children:e.jsx(Z,{colorScheme:Ne[s.estado]||"gray",variant:"subtle",children:s.estado})}),e.jsx(j,{children:s.wa_jid?e.jsx(u,{fontSize:"sm",color:"green.500",children:s.wa_jid}):e.jsx(u,{fontSize:"sm",color:"gray.500",children:"No configurado"})}),e.jsx(j,{children:e.jsx(u,{fontSize:"sm",children:new Date(s.created_at).toLocaleDateString()})}),e.jsx(j,{children:e.jsxs(g,{spacing:2,children:[e.jsx($,{label:"Ver detalles",children:e.jsx(T,{"aria-label":"Ver detalles",icon:e.jsx(Fe,{}),size:"sm",variant:"ghost",colorScheme:"blue"})}),e.jsx($,{label:"Editar usuario",children:e.jsx(T,{"aria-label":"Editar usuario",icon:e.jsx(Me,{}),size:"sm",variant:"ghost",colorScheme:"orange",onClick:()=>ne(s)})}),e.jsxs(ge,{children:[e.jsx(ve,{as:T,"aria-label":"Más opciones",icon:e.jsx(ze,{}),size:"sm",variant:"ghost"}),e.jsxs(Se,{children:[e.jsx(I,{icon:e.jsx(Ae,{}),onClick:()=>W(s.id,"activo"),isDisabled:s.estado==="activo",children:"Activar"}),e.jsx(I,{icon:e.jsx(Te,{}),onClick:()=>W(s.id,"inactivo"),isDisabled:s.estado==="inactivo",children:"Desactivar"}),e.jsx(Ce,{}),e.jsx(I,{icon:e.jsx(Ie,{}),color:"red.500",onClick:()=>de(s.id),children:"Eliminar"})]})]})]})})]},s.id))})]})}),(n==null?void 0:n.pagination)&&e.jsx(X,{justify:"center",mt:6,children:e.jsxs(g,{spacing:2,children:[e.jsx(m,{size:"sm",onClick:()=>P(l-1),isDisabled:l===1,children:"Anterior"}),e.jsxs(u,{children:["Página ",l," de ",n.pagination.totalPages]}),e.jsx(m,{size:"sm",onClick:()=>P(l+1),isDisabled:l===n.pagination.totalPages,children:"Siguiente"})]})})]})})]}),e.jsxs(Ee,{isOpen:ae,onClose:C,size:"lg",children:[e.jsx(be,{}),e.jsx(qe,{children:e.jsxs("form",{onSubmit:le,children:[e.jsx(fe,{children:d?"Editar Usuario":"Crear Nuevo Usuario"}),e.jsx(Ue,{children:e.jsxs(A,{spacing:4,children:[e.jsxs(v,{isRequired:!0,children:[e.jsx(S,{children:"Nombre de Usuario"}),e.jsx(f,{value:r.username,onChange:s=>c({...r,username:s.target.value}),placeholder:"Ingresa el nombre de usuario"})]}),e.jsxs(v,{isRequired:!d,children:[e.jsx(S,{children:d?"Nueva Contraseña (opcional)":"Contraseña"}),e.jsx(f,{type:"password",value:r.password,onChange:s=>c({...r,password:s.target.value}),placeholder:d?"Dejar vacío para mantener":"Ingresa la contraseña"})]}),e.jsxs(v,{isRequired:!0,children:[e.jsx(S,{children:"Roles"}),e.jsxs(R,{value:r.roles[0]||"usuario",onChange:s=>c({...r,roles:[s.target.value]}),children:[e.jsx("option",{value:"usuario",children:"Usuario"}),e.jsx("option",{value:"moderador",children:"Moderador"}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"owner",children:"Propietario"})]})]}),e.jsxs(v,{isRequired:!0,children:[e.jsx(S,{children:"Estado"}),e.jsxs(R,{value:r.estado,onChange:s=>c({...r,estado:s.target.value}),children:[e.jsx("option",{value:"activo",children:"Activo"}),e.jsx("option",{value:"inactivo",children:"Inactivo"}),e.jsx("option",{value:"suspendido",children:"Suspendido"})]})]}),e.jsxs(v,{children:[e.jsx(S,{children:"WhatsApp JID (opcional)"}),e.jsx(f,{value:r.wa_jid||"",onChange:s=>c({...r,wa_jid:s.target.value}),placeholder:"1234567890@s.whatsapp.net"})]})]})}),e.jsxs(Re,{children:[e.jsx(m,{variant:"ghost",mr:3,onClick:C,children:"Cancelar"}),e.jsx(m,{colorScheme:"blue",type:"submit",isLoading:H.isLoading||O.isLoading,children:d?"Actualizar":"Crear"})]})]})})]})]})};export{es as Usuarios,es as default};
//# sourceMappingURL=Usuarios-DQsfb_W2.js.map
