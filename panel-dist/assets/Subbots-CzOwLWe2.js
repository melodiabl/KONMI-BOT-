import{d as Z,r as d,t as ee,h as se,i as H,j as e,B as E,F as Q,S as re,V as T,H as te,T as r,q as a,m as b,A as ne,k as ae,s as p,l as $,M as oe,v as ie,w as le,x as ce,p as m}from"./index-CRkNY6ry.js";import{$ as de,s as he,a0 as xe,i as je,C as S,c as y,L as ue,u as N,l as ge,b as fe,g as be,D as pe}from"./index.esm-CzniNAqg.js";import{S as v,a as z,b as M,c as F}from"./stat-number-Cmk69z9o.js";import{T as me,a as Se,b as G,c as i,d as ye,e as l}from"./tr-Cbx9FMhk.js";import{T as U}from"./tooltip-DDxb5mqh.js";import{M as Ce,a as we}from"./modal-footer-B3ZHaos3.js";function Ee(h){return de({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M24 .01c0-.01 0-.01 0 0L0 0v24h24V.01zM0 0h24v24H0V0zm0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M22.99 9C19.15 5.16 13.8 3.76 8.84 4.78l2.52 2.52c3.47-.17 6.99 1.05 9.63 3.7l2-2zm-4 4a9.793 9.793 0 00-4.49-2.56l3.53 3.53.96-.97zM2 3.05L5.07 6.1C3.6 6.82 2.22 7.78 1 9l1.99 2c1.24-1.24 2.67-2.16 4.2-2.77l2.24 2.24A9.684 9.684 0 005 13v.01L6.99 15a7.042 7.042 0 014.92-2.06L18.98 20l1.27-1.26L3.29 1.79 2 3.05zM9 17l3 3 3-3a4.237 4.237 0 00-6 0z"}}]})(h)}const Ae=()=>{const{user:h,hasRole:Te}=Z(),[c,L]=d.useState([]),[k,A]=d.useState(!0),[O,D]=d.useState(null),[n,K]=d.useState(null),[C,j]=d.useState(null),{isOpen:P,onOpen:J,onClose:I}=ee(),u=se();H("white","gray.800"),H("gray.200","gray.600");const g=async()=>{try{A(!0);const s=await m.getSubbots();L(s.subbots||[]),D(null)}catch(s){D("Error cargando subbots"),console.error("Error cargando subbots:",s)}finally{A(!1)}},W=async s=>{try{j("create");const t=await m.createSubbot((h==null?void 0:h.id)||0,s);if(t.success)u({title:"Subbot creado",description:`Subbot ${s.toUpperCase()} creado exitosamente`,status:"success",duration:3e3,isClosable:!0}),await g();else throw new Error(t.error||"Error creando subbot")}catch{u({title:"Error",description:"Error creando subbot",status:"error",duration:3e3,isClosable:!0})}finally{j(null)}},X=async s=>{try{j(s);const t=await m.deleteSubbot(s);if(t.success)u({title:"Subbot eliminado",description:"Subbot eliminado exitosamente",status:"success",duration:3e3,isClosable:!0}),await g();else throw new Error(t.error||"Error eliminando subbot")}catch{u({title:"Error",description:"Error eliminando subbot",status:"error",duration:3e3,isClosable:!0})}finally{j(null)}},Y=async()=>{try{const s=await m.getSubbotStatus();L(t=>t.map(x=>{const o=s.subbots.find(f=>f.subbotId===x.code);return{...x,isOnline:(o==null?void 0:o.isOnline)||!1,status:(o==null?void 0:o.status)||x.status}}))}catch(s){console.error("Error obteniendo estado de subbots:",s)}};d.useEffect(()=>{g();const s=setInterval(Y,3e4);return()=>clearInterval(s)},[]);const q=(s,t)=>t?"green":s==="pending"?"yellow":s==="error"?"red":"gray",B=(s,t)=>t?"Conectado":s==="pending"?"Esperando QR":s==="error"?"Error":"Desconectado",R=s=>new Date(s).toLocaleString("es-ES"),V=s=>{const t=new Date,x=new Date(s),o=t.getTime()-x.getTime(),f=Math.floor(o/6e4),w=Math.floor(f/60),_=Math.floor(w/24);return _>0?`${_}d`:w>0?`${w}h`:`${f}m`};return k?e.jsx(E,{p:6,children:e.jsx(Q,{justify:"center",align:"center",h:"200px",children:e.jsx(re,{size:"xl"})})}):e.jsxs(E,{p:6,children:[e.jsxs(T,{spacing:6,align:"stretch",children:[e.jsxs(Q,{justify:"space-between",align:"center",children:[e.jsxs(T,{align:"start",spacing:2,children:[e.jsx(te,{size:"lg",color:"blue.500",children:"🤖 Gestión de Subbots"}),e.jsx(r,{color:"gray.600",children:"Administra tus subbots de WhatsApp"})]}),e.jsxs(a,{spacing:3,children:[e.jsx(b,{leftIcon:e.jsx(he,{}),colorScheme:"blue",onClick:()=>W("qr"),isLoading:C==="create",loadingText:"Creando...",children:"Nuevo QR"}),e.jsx(b,{leftIcon:e.jsx(xe,{}),colorScheme:"green",onClick:()=>W("code"),isLoading:C==="create",loadingText:"Creando...",children:"Nuevo Código"}),e.jsx(b,{leftIcon:e.jsx(je,{}),onClick:g,isLoading:k,children:"Actualizar"})]})]}),e.jsxs(a,{spacing:4,children:[e.jsx(S,{flex:"1",children:e.jsx(y,{children:e.jsxs(v,{children:[e.jsx(z,{children:"Total Subbots"}),e.jsx(M,{children:c.length}),e.jsxs(F,{children:[e.jsx(ue,{color:"blue"})," ",c.filter(s=>s.type==="qr").length," QR, ",c.filter(s=>s.type==="code").length," Códigos"]})]})})}),e.jsx(S,{flex:"1",children:e.jsx(y,{children:e.jsxs(v,{children:[e.jsx(z,{children:"Conectados"}),e.jsx(M,{color:"green.500",children:c.filter(s=>s.isOnline).length}),e.jsxs(F,{children:[e.jsx(N,{color:"green"})," Activos ahora"]})]})})}),e.jsx(S,{flex:"1",children:e.jsx(y,{children:e.jsxs(v,{children:[e.jsx(z,{children:"Esperando"}),e.jsx(M,{color:"yellow.500",children:c.filter(s=>s.status==="pending").length}),e.jsxs(F,{children:[e.jsx(ge,{color:"yellow"})," Por conectar"]})]})})})]}),O&&e.jsxs(ne,{status:"error",children:[e.jsx(ae,{}),O]}),e.jsx(S,{children:e.jsx(y,{children:e.jsxs(me,{variant:"simple",children:[e.jsx(Se,{children:e.jsxs(G,{children:[e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Tipo"}),e.jsx(i,{children:"Estado"}),e.jsx(i,{children:"Creado por"}),e.jsx(i,{children:"Creado"}),e.jsx(i,{children:"Última actividad"}),e.jsx(i,{children:"Acciones"})]})}),e.jsx(ye,{children:c.map(s=>e.jsxs(G,{children:[e.jsx(l,{children:e.jsx(r,{fontFamily:"mono",fontSize:"sm",children:s.code})}),e.jsx(l,{children:e.jsx(p,{colorScheme:s.type==="qr"?"blue":"green",variant:"subtle",children:s.type==="qr"?"QR":"Código"})}),e.jsx(l,{children:e.jsxs(a,{spacing:2,children:[e.jsx(p,{colorScheme:q(s.status,s.isOnline||!1),variant:"solid",children:B(s.status,s.isOnline||!1)}),s.isOnline?e.jsx(N,{color:"green"}):e.jsx(Ee,{color:"gray"})]})}),e.jsx(l,{children:e.jsxs(a,{spacing:2,children:[e.jsx(fe,{}),e.jsx(r,{fontSize:"sm",children:s.created_by})]})}),e.jsx(l,{children:e.jsx(r,{fontSize:"sm",children:R(s.created_at)})}),e.jsx(l,{children:e.jsx(r,{fontSize:"sm",children:V(s.last_heartbeat)})}),e.jsx(l,{children:e.jsxs(a,{spacing:2,children:[e.jsx(U,{label:"Ver detalles",children:e.jsx($,{"aria-label":"Ver detalles",icon:e.jsx(be,{}),size:"sm",variant:"ghost",onClick:()=>{K(s),J()}})}),e.jsx(U,{label:"Eliminar",children:e.jsx($,{"aria-label":"Eliminar",icon:e.jsx(pe,{}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>X(s.code),isLoading:C===s.code})})]})})]},s.id))})]})})})]}),e.jsxs(oe,{isOpen:P,onClose:I,size:"lg",children:[e.jsx(ie,{}),e.jsxs(Ce,{children:[e.jsx(le,{children:"Detalles del Subbot"}),e.jsx(ce,{children:n&&e.jsxs(T,{spacing:4,align:"stretch",children:[e.jsxs(a,{justify:"space-between",children:[e.jsx(r,{fontWeight:"bold",children:"ID:"}),e.jsx(r,{fontFamily:"mono",children:n.code})]}),e.jsxs(a,{justify:"space-between",children:[e.jsx(r,{fontWeight:"bold",children:"Tipo:"}),e.jsx(p,{colorScheme:n.type==="qr"?"blue":"green",children:n.type==="qr"?"QR":"Código"})]}),e.jsxs(a,{justify:"space-between",children:[e.jsx(r,{fontWeight:"bold",children:"Estado:"}),e.jsx(p,{colorScheme:q(n.status,n.isOnline||!1),children:B(n.status,n.isOnline||!1)})]}),e.jsxs(a,{justify:"space-between",children:[e.jsx(r,{fontWeight:"bold",children:"Creado por:"}),e.jsx(r,{children:n.created_by})]}),e.jsxs(a,{justify:"space-between",children:[e.jsx(r,{fontWeight:"bold",children:"Creado:"}),e.jsx(r,{children:R(n.created_at)})]}),e.jsxs(a,{justify:"space-between",children:[e.jsx(r,{fontWeight:"bold",children:"Última actividad:"}),e.jsx(r,{children:V(n.last_heartbeat)})]}),n.qr_data&&e.jsxs(E,{children:[e.jsx(r,{fontWeight:"bold",mb:2,children:"QR Data:"}),e.jsx(r,{fontFamily:"mono",fontSize:"sm",p:2,bg:"gray.100",borderRadius:"md",wordBreak:"break-all",children:n.qr_data})]})]})}),e.jsx(we,{children:e.jsx(b,{onClick:I,children:"Cerrar"})})]})]})]})};export{Ae as default};
//# sourceMappingURL=Subbots-CzOwLWe2.js.map
