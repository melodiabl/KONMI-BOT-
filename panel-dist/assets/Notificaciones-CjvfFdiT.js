import{r as g,t as de,h as he,n as xe,i as $,j as e,A as je,k as ue,B as t,V as c,F as q,H as ge,T as i,q as l,m,s as h,S as me,l as z,y as pe,z as fe,C as ye,E as T,G as Se,M as ve,v as be,w as Ce,x as Fe,D as Me,p as S}from"./index-CRkNY6ry.js";import{A as w,E as Ee,C as k,c as A,w as ze,a as Te,r as G,j as we,a2 as ke,N as _,a3 as Ae,S as Ie,g as Ne,y as We,b as Be,l as De,D as Le}from"./index.esm-CzniNAqg.js";import{u as I}from"./useMutation-tt7yEThG.js";import{u as U}from"./useQuery-B78dU_LM.js";import{I as Pe,a as Re}from"./input-element-D4QcLV82.js";import{I as Ve}from"./input-BR2M-WI7.js";import{S as N}from"./select-C8GCKjda.js";import{T as Qe,a as He,b as J,c as p,d as Oe,e as f}from"./tr-Cbx9FMhk.js";import{T as X}from"./tooltip-DDxb5mqh.js";import{M as $e,a as qe}from"./modal-footer-B3ZHaos3.js";const x={info:"blue",success:"green",warning:"orange",error:"red",system:"purple"},K={info:ke,success:we,warning:G,error:G,system:Te},Ge={system:"purple",user:"blue",content:"green",security:"red",general:"gray"},is=()=>{var O;const[W,Y]=g.useState(""),[B,Z]=g.useState(""),[D,ee]=g.useState(""),[L,se]=g.useState(""),[d,P]=g.useState(1),[a,re]=g.useState(null),{isOpen:ae,onOpen:ie,onClose:b}=de(),j=he(),u=xe(),C=$("white","gray.700"),F=$("gray.200","gray.600"),{data:o,isLoading:ne,error:R}=U(["notifications",d,W,B,D,L],()=>S.getNotificaciones(d,20)),{data:M}=U("notificationStats",()=>S.getNotificationStats()),oe=I(s=>S.markAsRead(s),{onSuccess:()=>{u.invalidateQueries("notifications"),u.invalidateQueries("notificationStats"),j({title:"Notificación marcada como leída",status:"success"})},onError:s=>{var n,r;j({title:"Error",description:((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Error al marcar como leída",status:"error"})}}),V=I(()=>S.markAllAsRead(),{onSuccess:()=>{u.invalidateQueries("notifications"),u.invalidateQueries("notificationStats"),j({title:"Todas las notificaciones marcadas como leídas",status:"success"})},onError:s=>{var n,r;j({title:"Error",description:((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Error al marcar todas como leídas",status:"error"})}}),te=I(s=>S.deleteNotification(s),{onSuccess:()=>{u.invalidateQueries("notifications"),u.invalidateQueries("notificationStats"),j({title:"Notificación eliminada",status:"success"})},onError:s=>{var n,r;j({title:"Error",description:((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Error al eliminar notificación",status:"error"})}}),E=s=>{oe.mutate(s)},le=()=>{window.confirm("¿Marcar todas las notificaciones como leídas?")&&V.mutate()},ce=s=>{window.confirm("¿Estás seguro de que quieres eliminar esta notificación?")&&te.mutate(s)},Q=s=>{re(s),s.read||E(s.id),ie()},H=s=>{const n=new Date(s),y=(new Date().getTime()-n.getTime())/(1e3*60*60);return y<1?"Hace unos minutos":y<24?`Hace ${Math.floor(y)} horas`:n.toLocaleDateString()},v=(()=>{if(!(o!=null&&o.notifications))return{total:0,unread:0,read:0};const s=o.notifications.length,n=o.notifications.filter(y=>!y.read).length,r=s-n;return{total:s,unread:n,read:r}})();return R?e.jsxs(je,{status:"error",children:[e.jsx(ue,{}),"Error al cargar notificaciones: ",R.message]}):e.jsxs(t,{children:[e.jsxs(c,{spacing:6,align:"stretch",children:[e.jsxs(q,{align:"center",justify:"space-between",children:[e.jsxs(t,{children:[e.jsx(ge,{size:"lg",children:"Notificaciones"}),e.jsx(i,{color:"gray.600",mt:1,children:"Gestión y visualización de notificaciones del sistema"})]}),e.jsxs(l,{spacing:3,children:[e.jsx(m,{leftIcon:e.jsx(w,{}),colorScheme:"blue",variant:"outline",onClick:le,isLoading:V.isLoading,isDisabled:v.unread===0,children:"Marcar todas como leídas"}),e.jsx(m,{leftIcon:e.jsx(Ee,{}),colorScheme:"green",variant:"outline",children:"Exportar"})]})]}),e.jsx(k,{bg:C,border:"1px",borderColor:F,children:e.jsx(A,{children:e.jsxs(l,{spacing:8,justify:"center",children:[e.jsxs(c,{children:[e.jsx(h,{colorScheme:"blue",size:"lg",children:v.total}),e.jsx(i,{fontSize:"sm",fontWeight:"semibold",children:"Total"})]}),e.jsxs(c,{children:[e.jsx(h,{colorScheme:"red",size:"lg",children:v.unread}),e.jsx(i,{fontSize:"sm",fontWeight:"semibold",children:"No leídas"})]}),e.jsxs(c,{children:[e.jsx(h,{colorScheme:"green",size:"lg",children:v.read}),e.jsx(i,{fontSize:"sm",fontWeight:"semibold",children:"Leídas"})]}),e.jsxs(c,{children:[e.jsx(h,{colorScheme:"purple",size:"lg",children:(M==null?void 0:M.totalCategories)||0}),e.jsx(i,{fontSize:"sm",fontWeight:"semibold",children:"Categorías"})]})]})})}),e.jsx(k,{bg:C,border:"1px",borderColor:F,children:e.jsx(A,{children:e.jsxs(l,{spacing:4,wrap:"wrap",children:[e.jsxs(Pe,{maxW:"300px",children:[e.jsx(Re,{pointerEvents:"none",children:e.jsx(ze,{color:"gray.300"})}),e.jsx(Ve,{placeholder:"Buscar notificaciones...",value:W,onChange:s=>Y(s.target.value)})]}),e.jsxs(N,{placeholder:"Filtrar por tipo",value:B,onChange:s=>Z(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"system",children:"System"})]}),e.jsxs(N,{placeholder:"Filtrar por categoría",value:D,onChange:s=>ee(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"system",children:"Sistema"}),e.jsx("option",{value:"user",children:"Usuario"}),e.jsx("option",{value:"content",children:"Contenido"}),e.jsx("option",{value:"security",children:"Seguridad"}),e.jsx("option",{value:"general",children:"General"})]}),e.jsxs(N,{placeholder:"Filtrar por estado",value:L,onChange:s=>se(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"unread",children:"No leídas"}),e.jsx("option",{value:"read",children:"Leídas"})]})]})})}),e.jsx(k,{bg:C,border:"1px",borderColor:F,children:e.jsxs(A,{children:[ne?e.jsxs(t,{textAlign:"center",py:8,children:[e.jsx(me,{size:"xl"}),e.jsx(i,{mt:4,children:"Cargando notificaciones..."})]}):e.jsx(t,{overflowX:"auto",children:e.jsxs(Qe,{variant:"simple",children:[e.jsx(He,{children:e.jsxs(J,{children:[e.jsx(p,{children:"Estado"}),e.jsx(p,{children:"Título"}),e.jsx(p,{children:"Tipo"}),e.jsx(p,{children:"Categoría"}),e.jsx(p,{children:"Fecha"}),e.jsx(p,{children:"Acciones"})]})}),e.jsx(Oe,{children:(O=o==null?void 0:o.notifications)==null?void 0:O.map(s=>{const n=K[s.type]||_;return e.jsxs(J,{bg:s.read?void 0:`${x[s.type]}.50`,_hover:{bg:`${x[s.type]}.100`},cursor:"pointer",onClick:()=>Q(s),children:[e.jsx(f,{children:e.jsxs(l,{children:[s.read?e.jsx(Ae,{color:"gray"}):e.jsx(Ie,{color:"blue"}),!s.read&&e.jsx(t,{w:2,h:2,borderRadius:"full",bg:`${x[s.type]}.500`})]})}),e.jsx(f,{children:e.jsxs(c,{align:"start",spacing:1,children:[e.jsx(i,{fontWeight:"semibold",color:s.read?void 0:"blue.600",children:s.title}),e.jsx(i,{fontSize:"sm",color:"gray.500",noOfLines:2,children:s.message})]})}),e.jsx(f,{children:e.jsxs(l,{children:[e.jsx(t,{as:n,color:`${x[s.type]}.500`}),e.jsx(h,{colorScheme:x[s.type]||"gray",variant:"subtle",children:s.type})]})}),e.jsx(f,{children:e.jsx(h,{colorScheme:Ge[s.category]||"gray",variant:"subtle",children:s.category})}),e.jsx(f,{children:e.jsxs(c,{align:"start",spacing:0,children:[e.jsx(i,{fontSize:"sm",children:H(s.created_at)}),e.jsx(i,{fontSize:"xs",color:"gray.500",children:new Date(s.created_at).toLocaleDateString()})]})}),e.jsx(f,{children:e.jsxs(l,{spacing:2,children:[e.jsx(X,{label:"Ver detalles",children:e.jsx(z,{"aria-label":"Ver detalles",icon:e.jsx(Ne,{}),size:"sm",variant:"ghost",colorScheme:"blue",onClick:r=>{r.stopPropagation(),Q(s)}})}),!s.read&&e.jsx(X,{label:"Marcar como leída",children:e.jsx(z,{"aria-label":"Marcar como leída",icon:e.jsx(w,{}),size:"sm",variant:"ghost",colorScheme:"green",onClick:r=>{r.stopPropagation(),E(s.id)}})}),e.jsxs(pe,{children:[e.jsx(fe,{as:z,"aria-label":"Más opciones",icon:e.jsx(We,{}),size:"sm",variant:"ghost",onClick:r=>r.stopPropagation()}),e.jsxs(ye,{children:[e.jsx(T,{icon:e.jsx(Be,{}),children:"Ver usuario"}),e.jsx(T,{icon:e.jsx(De,{}),children:"Ver historial"}),e.jsx(Se,{}),e.jsx(T,{icon:e.jsx(Le,{}),color:"red.500",onClick:r=>{r.stopPropagation(),ce(s.id)},children:"Eliminar"})]})]})]})})]},s.id)})})]})}),(o==null?void 0:o.pagination)&&e.jsx(q,{justify:"center",mt:6,children:e.jsxs(l,{spacing:2,children:[e.jsx(m,{size:"sm",onClick:()=>P(d-1),isDisabled:d===1,children:"Anterior"}),e.jsxs(i,{children:["Página ",d," de ",o.pagination.totalPages]}),e.jsx(m,{size:"sm",onClick:()=>P(d+1),isDisabled:d===o.pagination.totalPages,children:"Siguiente"})]})})]})})]}),e.jsxs(ve,{isOpen:ae,onClose:b,size:"lg",children:[e.jsx(be,{}),e.jsxs($e,{children:[e.jsx(Ce,{children:e.jsxs(l,{children:[e.jsx(t,{as:K[a==null?void 0:a.type]||_,color:`${x[a==null?void 0:a.type]}.500`}),e.jsx(i,{children:"Detalles de la Notificación"})]})}),e.jsx(Fe,{children:a&&e.jsxs(c,{spacing:4,align:"stretch",children:[e.jsxs(t,{children:[e.jsxs(l,{justify:"space-between",mb:2,children:[e.jsx(i,{fontWeight:"semibold",fontSize:"lg",children:a.title}),e.jsx(h,{colorScheme:x[a.type],children:a.type})]}),e.jsxs(i,{fontSize:"sm",color:"gray.600",children:[H(a.created_at)," • ",a.category]})]}),e.jsx(Me,{}),e.jsxs(t,{children:[e.jsx(i,{fontWeight:"semibold",mb:2,children:"Mensaje"}),e.jsx(i,{children:a.message})]}),a.metadata&&e.jsxs(t,{children:[e.jsx(i,{fontWeight:"semibold",mb:2,children:"Información Adicional"}),e.jsx(i,{fontSize:"sm",color:"gray.600",children:JSON.stringify(a.metadata,null,2)})]})]})}),e.jsx(qe,{children:e.jsxs(l,{spacing:3,children:[a&&!a.read&&e.jsx(m,{leftIcon:e.jsx(w,{}),colorScheme:"green",onClick:()=>{E(a.id),b()},children:"Marcar como leída"}),e.jsx(m,{onClick:b,children:"Cerrar"})]})})]})]})]})};export{is as Notificaciones,is as default};
//# sourceMappingURL=Notificaciones-CjvfFdiT.js.map
