import{r as p,t as ge,h as ve,n as ze,i as J,p as u,j as e,A as Se,k as fe,B as F,V as A,F as U,H as be,m as g,q as j,S as Ce,T as i,s as X,l as M,y as Ee,z as Ge,C as ye,E as T,G as Fe,M as Ae,v as Me,w as Te,x as _e}from"./index-CRkNY6ry.js";import{v as we,C as _,c as w,w as ke,g as Pe,x as Ie,y as De,z as Be,A as K,B as Y,D as Le}from"./index.esm-CzniNAqg.js";import{u as v}from"./useMutation-tt7yEThG.js";import{u as Z}from"./useQuery-B78dU_LM.js";import{S as k,a as P,b as I,c as D}from"./stat-number-Cmk69z9o.js";import{I as Qe,a as Ne}from"./input-element-D4QcLV82.js";import{I as B}from"./input-BR2M-WI7.js";import{S as $,F as z}from"./select-C8GCKjda.js";import{T as qe,a as Oe,b as ee,c as h,d as Ve,e as x}from"./tr-Cbx9FMhk.js";import{T as re}from"./tooltip-DDxb5mqh.js";import{M as We,a as He}from"./modal-footer-B3ZHaos3.js";import{F as S}from"./form-label-DaOodn7p.js";import{T as Re}from"./textarea-p1Zsad_O.js";import{S as se}from"./switch-B-2mnAik.js";import"./use-checkbox-CV8AuttE.js";const lr=()=>{var R;const[C,oe]=p.useState(""),[L,ae]=p.useState(""),[Q,ie]=p.useState(""),[d,N]=p.useState(1),[f,q]=p.useState(null),[a,c]=p.useState({nombre:"",descripcion:"",wa_jid:"",autorizado:!1,es_proveedor:!1}),{isOpen:te,onOpen:O,onClose:b}=ge(),t=ve(),m=ze(),E=J("white","gray.700"),G=J("gray.200","gray.600"),{data:l,isLoading:ne,error:V}=Z(["grupos",d,C,L,Q],()=>u.getGroups(d,20,C)),{data:n}=Z("groupStats",u.getGroupStats),W=v(u.createGrupo,{onSuccess:()=>{m.invalidateQueries("grupos"),t({title:"Grupo creado",description:"El grupo ha sido creado exitosamente",status:"success"}),b(),y()},onError:r=>{var s,o;t({title:"Error",description:((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"Error al crear grupo",status:"error"})}}),H=v(r=>u.updateGrupo(r.id,r.group),{onSuccess:()=>{m.invalidateQueries("grupos"),t({title:"Grupo actualizado",description:"El grupo ha sido actualizado exitosamente",status:"success"}),b(),y()},onError:r=>{var s,o;t({title:"Error",description:((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"Error al actualizar grupo",status:"error"})}}),le=v(u.deleteGrupo,{onSuccess:()=>{m.invalidateQueries("grupos"),t({title:"Grupo eliminado",description:"El grupo ha sido eliminado exitosamente",status:"success"})},onError:r=>{var s,o;t({title:"Error",description:((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"Error al eliminar grupo",status:"error"})}}),de=v(r=>u.authorizeGroup(r.id,r.autorizado),{onSuccess:()=>{m.invalidateQueries("grupos"),t({title:"Autorización actualizada",description:"La autorización del grupo ha sido actualizada",status:"success"})},onError:r=>{var s,o;t({title:"Error",description:((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"Error al actualizar autorización",status:"error"})}}),ce=v(r=>u.toggleProvider(r.id,r.es_proveedor),{onSuccess:()=>{m.invalidateQueries("grupos"),t({title:"Estado de proveedor actualizado",description:"El estado de proveedor ha sido actualizado",status:"success"})},onError:r=>{var s,o;t({title:"Error",description:((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"Error al actualizar estado de proveedor",status:"error"})}}),y=()=>{c({nombre:"",descripcion:"",wa_jid:"",autorizado:!1,es_proveedor:!1}),q(null)},ue=()=>{y(),O()},he=r=>{q(r),c({nombre:r.nombre,descripcion:r.descripcion||"",wa_jid:r.wa_jid,autorizado:r.autorizado,es_proveedor:r.es_proveedor}),O()},xe=r=>{r.preventDefault(),f?H.mutate({id:f.id,group:a}):W.mutate(a)},pe=r=>{window.confirm("¿Estás seguro de que quieres eliminar este grupo?")&&le.mutate(r)},je=(r,s)=>{de.mutate({id:r,autorizado:s})},me=(r,s)=>{ce.mutate({id:r,es_proveedor:s})};return V?e.jsxs(Se,{status:"error",children:[e.jsx(fe,{}),"Error al cargar grupos: ",V.message]}):e.jsxs(F,{children:[e.jsxs(A,{spacing:6,align:"stretch",children:[e.jsxs(U,{align:"center",justify:"space-between",children:[e.jsx(be,{size:"lg",children:"Gestión de Grupos"}),e.jsx(g,{leftIcon:e.jsx(we,{}),colorScheme:"green",onClick:ue,children:"Nuevo Grupo"})]}),e.jsx(_,{bg:E,border:"1px",borderColor:G,children:e.jsx(w,{children:e.jsxs(j,{spacing:8,justify:"center",children:[e.jsxs(k,{textAlign:"center",children:[e.jsx(P,{children:"Total Grupos"}),e.jsx(I,{children:(n==null?void 0:n.totalGrupos)||0}),e.jsx(D,{children:"Registrados en el sistema"})]}),e.jsxs(k,{textAlign:"center",children:[e.jsx(P,{children:"Autorizados"}),e.jsx(I,{color:"green.500",children:(n==null?void 0:n.gruposAutorizados)||0}),e.jsx(D,{children:"Grupos autorizados"})]}),e.jsxs(k,{textAlign:"center",children:[e.jsx(P,{children:"Proveedores"}),e.jsx(I,{color:"blue.500",children:(n==null?void 0:n.gruposProveedores)||0}),e.jsx(D,{children:"Grupos proveedores"})]})]})})}),e.jsx(_,{bg:E,border:"1px",borderColor:G,children:e.jsx(w,{children:e.jsxs(j,{spacing:4,children:[e.jsxs(Qe,{maxW:"300px",children:[e.jsx(Ne,{pointerEvents:"none",children:e.jsx(ke,{color:"gray.300"})}),e.jsx(B,{placeholder:"Buscar grupos...",value:C,onChange:r=>oe(r.target.value)})]}),e.jsxs($,{placeholder:"Filtrar por autorización",value:L,onChange:r=>ae(r.target.value),maxW:"200px",children:[e.jsx("option",{value:"true",children:"Autorizados"}),e.jsx("option",{value:"false",children:"No autorizados"})]}),e.jsxs($,{placeholder:"Filtrar por proveedor",value:Q,onChange:r=>ie(r.target.value),maxW:"200px",children:[e.jsx("option",{value:"true",children:"Proveedores"}),e.jsx("option",{value:"false",children:"No proveedores"})]})]})})}),e.jsx(_,{bg:E,border:"1px",borderColor:G,children:e.jsxs(w,{children:[ne?e.jsxs(F,{textAlign:"center",py:8,children:[e.jsx(Ce,{size:"xl"}),e.jsx(i,{mt:4,children:"Cargando grupos..."})]}):e.jsx(F,{overflowX:"auto",children:e.jsxs(qe,{variant:"simple",children:[e.jsx(Oe,{children:e.jsxs(ee,{children:[e.jsx(h,{children:"Grupo"}),e.jsx(h,{children:"WhatsApp JID"}),e.jsx(h,{children:"Autorizado"}),e.jsx(h,{children:"Proveedor"}),e.jsx(h,{children:"Usuario"}),e.jsx(h,{children:"Fecha Creación"}),e.jsx(h,{children:"Acciones"})]})}),e.jsx(Ve,{children:(R=l==null?void 0:l.grupos)==null?void 0:R.map(r=>e.jsxs(ee,{children:[e.jsx(x,{children:e.jsxs(A,{align:"start",spacing:1,children:[e.jsx(i,{fontWeight:"semibold",children:r.nombre}),r.descripcion&&e.jsx(i,{fontSize:"sm",color:"gray.500",noOfLines:2,children:r.descripcion}),e.jsxs(i,{fontSize:"xs",color:"gray.400",children:["ID: ",r.id]})]})}),e.jsx(x,{children:e.jsx(i,{fontSize:"sm",fontFamily:"mono",children:r.wa_jid})}),e.jsx(x,{children:e.jsx(X,{colorScheme:r.autorizado?"green":"red",variant:"subtle",children:r.autorizado?"Autorizado":"No autorizado"})}),e.jsx(x,{children:e.jsx(X,{colorScheme:r.es_proveedor?"blue":"gray",variant:"subtle",children:r.es_proveedor?"Proveedor":"Usuario"})}),e.jsx(x,{children:r.usuario?e.jsx(i,{fontSize:"sm",children:r.usuario.username}):e.jsx(i,{fontSize:"sm",color:"gray.500",children:"Sin asignar"})}),e.jsx(x,{children:e.jsx(i,{fontSize:"sm",children:new Date(r.created_at).toLocaleDateString()})}),e.jsx(x,{children:e.jsxs(j,{spacing:2,children:[e.jsx(re,{label:"Ver detalles",children:e.jsx(M,{"aria-label":"Ver detalles",icon:e.jsx(Pe,{}),size:"sm",variant:"ghost",colorScheme:"blue"})}),e.jsx(re,{label:"Editar grupo",children:e.jsx(M,{"aria-label":"Editar grupo",icon:e.jsx(Ie,{}),size:"sm",variant:"ghost",colorScheme:"orange",onClick:()=>he(r)})}),e.jsxs(Ee,{children:[e.jsx(Ge,{as:M,"aria-label":"Más opciones",icon:e.jsx(De,{}),size:"sm",variant:"ghost"}),e.jsxs(ye,{children:[e.jsx(T,{icon:r.autorizado?e.jsx(Be,{}):e.jsx(K,{}),onClick:()=>je(r.id,!r.autorizado),children:r.autorizado?"Desautorizar":"Autorizar"}),e.jsx(T,{icon:e.jsx(Y,{}),onClick:()=>me(r.id,!r.es_proveedor),children:r.es_proveedor?"Quitar proveedor":"Marcar como proveedor"}),e.jsx(Fe,{}),e.jsx(T,{icon:e.jsx(Le,{}),color:"red.500",onClick:()=>pe(r.id),children:"Eliminar"})]})]})]})})]},r.id))})]})}),(l==null?void 0:l.pagination)&&e.jsx(U,{justify:"center",mt:6,children:e.jsxs(j,{spacing:2,children:[e.jsx(g,{size:"sm",onClick:()=>N(d-1),isDisabled:d===1,children:"Anterior"}),e.jsxs(i,{children:["Página ",d," de ",l.pagination.totalPages]}),e.jsx(g,{size:"sm",onClick:()=>N(d+1),isDisabled:d===l.pagination.totalPages,children:"Siguiente"})]})})]})})]}),e.jsxs(Ae,{isOpen:te,onClose:b,size:"lg",children:[e.jsx(Me,{}),e.jsx(We,{children:e.jsxs("form",{onSubmit:xe,children:[e.jsx(Te,{children:f?"Editar Grupo":"Crear Nuevo Grupo"}),e.jsx(_e,{children:e.jsxs(A,{spacing:4,children:[e.jsxs(z,{isRequired:!0,children:[e.jsx(S,{children:"Nombre del Grupo"}),e.jsx(B,{value:a.nombre,onChange:r=>c({...a,nombre:r.target.value}),placeholder:"Ingresa el nombre del grupo"})]}),e.jsxs(z,{children:[e.jsx(S,{children:"Descripción"}),e.jsx(Re,{value:a.descripcion,onChange:r=>c({...a,descripcion:r.target.value}),placeholder:"Descripción opcional del grupo",rows:3})]}),e.jsxs(z,{isRequired:!0,children:[e.jsx(S,{children:"WhatsApp JID"}),e.jsx(B,{value:a.wa_jid,onChange:r=>c({...a,wa_jid:r.target.value}),placeholder:"1234567890-1234567890@g.us"})]}),e.jsxs(z,{display:"flex",alignItems:"center",children:[e.jsx(S,{mb:"0",children:e.jsxs(j,{children:[e.jsx(K,{}),e.jsx(i,{children:"Autorizado"})]})}),e.jsx(se,{isChecked:a.autorizado,onChange:r=>c({...a,autorizado:r.target.checked}),colorScheme:"green"})]}),e.jsxs(z,{display:"flex",alignItems:"center",children:[e.jsx(S,{mb:"0",children:e.jsxs(j,{children:[e.jsx(Y,{}),e.jsx(i,{children:"Es Proveedor"})]})}),e.jsx(se,{isChecked:a.es_proveedor,onChange:r=>c({...a,es_proveedor:r.target.checked}),colorScheme:"blue"})]})]})}),e.jsxs(He,{children:[e.jsx(g,{variant:"ghost",mr:3,onClick:b,children:"Cancelar"}),e.jsx(g,{colorScheme:"blue",type:"submit",isLoading:W.isLoading||H.isLoading,children:f?"Actualizar":"Crear"})]})]})})]})]})};export{lr as Grupos,lr as default};
//# sourceMappingURL=Grupos-HS-4hcqH.js.map
