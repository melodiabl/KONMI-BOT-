import{r as c,t as me,h as ge,n as ve,i as K,p as x,j as e,A as be,k as Ae,B as P,V as B,F as Y,H as fe,m as v,q as C,S as Se,T as u,s as L,l as q,y as Ce,z as Ee,C as ze,E as b,G as Fe,M as ye,v as Te,w as Me,x as we}from"./index-CRkNY6ry.js";import{v as ke,C as O,c as V,w as De,g as Ie,x as Re,y as Pe,A as Be,z as Le,E as qe,G as Oe,D as Ve}from"./index.esm-CzniNAqg.js";import{u as E}from"./useMutation-tt7yEThG.js";import{u as Z}from"./useQuery-B78dU_LM.js";import{S as z,a as F,b as y,c as T}from"./stat-number-Cmk69z9o.js";import{I as Ne,a as Qe}from"./input-element-D4QcLV82.js";import{I as $}from"./input-BR2M-WI7.js";import{S as j,F as m}from"./select-C8GCKjda.js";import{T as He,a as We,b as ee,c as h,d as _e,e as p}from"./tr-Cbx9FMhk.js";import{T as se}from"./tooltip-DDxb5mqh.js";import{M as Ge,a as Ue}from"./modal-footer-B3ZHaos3.js";import{F as g}from"./form-label-DaOodn7p.js";import{T as re}from"./textarea-p1Zsad_O.js";const Xe={pendiente:"yellow",aprobado:"green",rechazado:"red",revisando:"blue"},Je={manga:"purple",anime:"blue",novela:"green",imagen:"pink",video:"red",otro:"gray"},Ke={usuario:"blue",proveedor:"green",admin:"red",sistema:"gray"},cs=()=>{var J;const[M,oe]=c.useState(""),[w,ae]=c.useState(""),[k,ie]=c.useState(""),[N,ne]=c.useState(""),[d,Q]=c.useState(1),[A,H]=c.useState(null),[o,n]=c.useState({titulo:"",descripcion:"",contenido:"",tipo:"manga",fuente:"colaborador",estado:"pendiente"}),{isOpen:te,onOpen:W,onClose:f}=me(),t=ge(),S=ve(),D=K("white","gray.700"),I=K("gray.200","gray.600"),{data:l,isLoading:le,error:_}=Z(["aportes",d,M,w,k,N],()=>x.getAportes(d,20,M,w,k)),{data:a}=Z("aporteStats",x.getAporteStats),G=E(x.createAporte,{onSuccess:()=>{S.invalidateQueries("aportes"),t({title:"Aporte creado",description:"El aporte ha sido creado exitosamente",status:"success"}),f(),R()},onError:s=>{var r,i;t({title:"Error",description:((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Error al crear aporte",status:"error"})}}),U=E(s=>x.updateAporte(s.id,s.aporte),{onSuccess:()=>{S.invalidateQueries("aportes"),t({title:"Aporte actualizado",description:"El aporte ha sido actualizado exitosamente",status:"success"}),f(),R()},onError:s=>{var r,i;t({title:"Error",description:((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Error al actualizar aporte",status:"error"})}}),de=E(x.deleteAporte,{onSuccess:()=>{S.invalidateQueries("aportes"),t({title:"Aporte eliminado",description:"El aporte ha sido eliminado exitosamente",status:"success"})},onError:s=>{var r,i;t({title:"Error",description:((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Error al eliminar aporte",status:"error"})}}),X=E(s=>x.approveAporte(s.id,s.estado,s.motivo_rechazo),{onSuccess:()=>{S.invalidateQueries("aportes"),t({title:"Estado actualizado",description:"El estado del aporte ha sido actualizado",status:"success"})},onError:s=>{var r,i;t({title:"Error",description:((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.message)||"Error al actualizar estado",status:"error"})}}),R=()=>{n({titulo:"",descripcion:"",contenido:"",tipo:"manga",fuente:"colaborador",estado:"pendiente"}),H(null)},ce=()=>{R(),W()},ue=s=>{H(s),n({titulo:s.titulo,descripcion:s.descripcion||"",contenido:s.contenido,tipo:s.tipo,fuente:s.fuente,estado:s.estado,grupo_id:s.grupo_id}),W()},he=s=>{s.preventDefault(),A?U.mutate({id:A.id,aporte:o}):G.mutate(o)},pe=s=>{window.confirm("¿Estás seguro de que quieres eliminar este aporte?")&&de.mutate(s)},xe=s=>{X.mutate({id:s,estado:"aprobado"})},je=s=>{const r=window.prompt("Motivo del rechazo:");r!==null&&X.mutate({id:s,estado:"rechazado",motivo_rechazo:r})};return _?e.jsxs(be,{status:"error",children:[e.jsx(Ae,{}),"Error al cargar aportes: ",_.message]}):e.jsxs(P,{children:[e.jsxs(B,{spacing:6,align:"stretch",children:[e.jsxs(Y,{align:"center",justify:"space-between",children:[e.jsx(fe,{size:"lg",children:"Gestión de Aportes"}),e.jsx(v,{leftIcon:e.jsx(ke,{}),colorScheme:"green",onClick:ce,children:"Nuevo Aporte"})]}),e.jsx(O,{bg:D,border:"1px",borderColor:I,children:e.jsx(V,{children:e.jsxs(C,{spacing:8,justify:"center",children:[e.jsxs(z,{textAlign:"center",children:[e.jsx(F,{children:"Total Aportes"}),e.jsx(y,{children:(a==null?void 0:a.totalAportes)||0}),e.jsx(T,{children:"En el sistema"})]}),e.jsxs(z,{textAlign:"center",children:[e.jsx(F,{children:"Aprobados"}),e.jsx(y,{color:"green.500",children:(a==null?void 0:a.aportesAprobados)||0}),e.jsx(T,{children:"Aportes aprobados"})]}),e.jsxs(z,{textAlign:"center",children:[e.jsx(F,{children:"Pendientes"}),e.jsx(y,{color:"yellow.500",children:(a==null?void 0:a.aportesPendientes)||0}),e.jsx(T,{children:"En revisión"})]}),e.jsxs(z,{textAlign:"center",children:[e.jsx(F,{children:"Rechazados"}),e.jsx(y,{color:"red.500",children:(a==null?void 0:a.aportesRechazados)||0}),e.jsx(T,{children:"Aportes rechazados"})]})]})})}),e.jsx(O,{bg:D,border:"1px",borderColor:I,children:e.jsx(V,{children:e.jsxs(C,{spacing:4,wrap:"wrap",children:[e.jsxs(Ne,{maxW:"300px",children:[e.jsx(Qe,{pointerEvents:"none",children:e.jsx(De,{color:"gray.300"})}),e.jsx($,{placeholder:"Buscar aportes...",value:M,onChange:s=>oe(s.target.value)})]}),e.jsxs(j,{placeholder:"Filtrar por estado",value:w,onChange:s=>ae(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"aprobado",children:"Aprobado"}),e.jsx("option",{value:"rechazado",children:"Rechazado"}),e.jsx("option",{value:"revisando",children:"Revisando"})]}),e.jsxs(j,{placeholder:"Filtrar por tipo",value:N,onChange:s=>ne(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"manga",children:"Manga"}),e.jsx("option",{value:"anime",children:"Anime"}),e.jsx("option",{value:"novela",children:"Novela"}),e.jsx("option",{value:"imagen",children:"Imagen"}),e.jsx("option",{value:"video",children:"Video"}),e.jsx("option",{value:"otro",children:"Otro"})]}),e.jsxs(j,{placeholder:"Filtrar por fuente",value:k,onChange:s=>ie(s.target.value),maxW:"200px",children:[e.jsx("option",{value:"usuario",children:"Usuario"}),e.jsx("option",{value:"proveedor",children:"Proveedor"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"sistema",children:"Sistema"})]})]})})}),e.jsx(O,{bg:D,border:"1px",borderColor:I,children:e.jsxs(V,{children:[le?e.jsxs(P,{textAlign:"center",py:8,children:[e.jsx(Se,{size:"xl"}),e.jsx(u,{mt:4,children:"Cargando aportes..."})]}):e.jsx(P,{overflowX:"auto",children:e.jsxs(He,{variant:"simple",children:[e.jsx(We,{children:e.jsxs(ee,{children:[e.jsx(h,{children:"Título"}),e.jsx(h,{children:"Tipo"}),e.jsx(h,{children:"Fuente"}),e.jsx(h,{children:"Estado"}),e.jsx(h,{children:"Usuario"}),e.jsx(h,{children:"Fecha"}),e.jsx(h,{children:"Acciones"})]})}),e.jsx(_e,{children:(J=l==null?void 0:l.aportes)==null?void 0:J.map(s=>{var r;return e.jsxs(ee,{children:[e.jsx(p,{children:e.jsxs(B,{align:"start",spacing:1,children:[e.jsx(u,{fontWeight:"semibold",children:s.titulo}),s.descripcion&&e.jsx(u,{fontSize:"sm",color:"gray.500",noOfLines:2,children:s.descripcion}),e.jsxs(u,{fontSize:"xs",color:"gray.400",children:["ID: ",s.id]})]})}),e.jsx(p,{children:e.jsx(L,{colorScheme:Je[s.tipo]||"gray",variant:"subtle",children:s.tipo})}),e.jsx(p,{children:e.jsx(L,{colorScheme:Ke[s.fuente]||"gray",variant:"subtle",children:s.fuente})}),e.jsx(p,{children:e.jsx(L,{colorScheme:Xe[s.estado]||"gray",variant:"subtle",children:s.estado})}),e.jsx(p,{children:e.jsx(u,{fontSize:"sm",children:((r=s.usuario)==null?void 0:r.username)||"N/A"})}),e.jsx(p,{children:e.jsx(u,{fontSize:"sm",children:new Date(s.created_at).toLocaleDateString()})}),e.jsx(p,{children:e.jsxs(C,{spacing:2,children:[e.jsx(se,{label:"Ver detalles",children:e.jsx(q,{"aria-label":"Ver detalles",icon:e.jsx(Ie,{}),size:"sm",variant:"ghost",colorScheme:"blue"})}),e.jsx(se,{label:"Editar aporte",children:e.jsx(q,{"aria-label":"Editar aporte",icon:e.jsx(Re,{}),size:"sm",variant:"ghost",colorScheme:"orange",onClick:()=>ue(s)})}),e.jsxs(Ce,{children:[e.jsx(Ee,{as:q,"aria-label":"Más opciones",icon:e.jsx(Pe,{}),size:"sm",variant:"ghost"}),e.jsxs(ze,{children:[s.estado==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx(b,{icon:e.jsx(Be,{}),onClick:()=>xe(s.id),children:"Aprobar"}),e.jsx(b,{icon:e.jsx(Le,{}),onClick:()=>je(s.id),children:"Rechazar"})]}),e.jsx(b,{icon:e.jsx(qe,{}),children:"Descargar"}),e.jsx(b,{icon:e.jsx(Oe,{}),children:"Compartir"}),e.jsx(Fe,{}),e.jsx(b,{icon:e.jsx(Ve,{}),color:"red.500",onClick:()=>pe(s.id),children:"Eliminar"})]})]})]})})]},s.id)})})]})}),(l==null?void 0:l.pagination)&&e.jsx(Y,{justify:"center",mt:6,children:e.jsxs(C,{spacing:2,children:[e.jsx(v,{size:"sm",onClick:()=>Q(d-1),isDisabled:d===1,children:"Anterior"}),e.jsxs(u,{children:["Página ",d," de ",l.pagination.totalPages]}),e.jsx(v,{size:"sm",onClick:()=>Q(d+1),isDisabled:d===l.pagination.totalPages,children:"Siguiente"})]})})]})})]}),e.jsxs(ye,{isOpen:te,onClose:f,size:"xl",children:[e.jsx(Te,{}),e.jsx(Ge,{children:e.jsxs("form",{onSubmit:he,children:[e.jsx(Me,{children:A?"Editar Aporte":"Crear Nuevo Aporte"}),e.jsx(we,{children:e.jsxs(B,{spacing:4,children:[e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Título"}),e.jsx($,{value:o.titulo,onChange:s=>n({...o,titulo:s.target.value}),placeholder:"Ingresa el título del aporte"})]}),e.jsxs(m,{children:[e.jsx(g,{children:"Descripción"}),e.jsx(re,{value:o.descripcion,onChange:s=>n({...o,descripcion:s.target.value}),placeholder:"Descripción opcional del aporte",rows:3})]}),e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Contenido"}),e.jsx(re,{value:o.contenido,onChange:s=>n({...o,contenido:s.target.value}),placeholder:"Contenido del aporte (enlace, texto, etc.)",rows:5})]}),e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Tipo"}),e.jsxs(j,{value:o.tipo,onChange:s=>n({...o,tipo:s.target.value}),children:[e.jsx("option",{value:"manga",children:"Manga"}),e.jsx("option",{value:"anime",children:"Anime"}),e.jsx("option",{value:"novela",children:"Novela"}),e.jsx("option",{value:"imagen",children:"Imagen"}),e.jsx("option",{value:"video",children:"Video"}),e.jsx("option",{value:"otro",children:"Otro"})]})]}),e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Fuente"}),e.jsxs(j,{value:o.fuente,onChange:s=>n({...o,fuente:s.target.value}),children:[e.jsx("option",{value:"colaborador",children:"Colaborador"}),e.jsx("option",{value:"proveedor",children:"Proveedor"})]})]}),e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Estado"}),e.jsxs(j,{value:o.estado,onChange:s=>n({...o,estado:s.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"aprobado",children:"Aprobado"}),e.jsx("option",{value:"rechazado",children:"Rechazado"})]})]})]})}),e.jsxs(Ue,{children:[e.jsx(v,{variant:"ghost",mr:3,onClick:f,children:"Cancelar"}),e.jsx(v,{colorScheme:"blue",type:"submit",isLoading:G.isLoading||U.isLoading,children:A?"Actualizar":"Crear"})]})]})})]})]})};export{cs as Aportes,cs as default};
//# sourceMappingURL=Aportes-DNB-I4Wj.js.map
