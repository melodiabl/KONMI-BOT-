import{r as N,t as ae,h as le,n as de,i as P,p as h,j as e,A as V,k as G,B as t,V as m,F as xe,H as b,T as n,q as o,m as a,I as S,D as he,s as $,M as U,v as J,w as K,x as X,S as je}from"./index-CRkNY6ry.js";import{s as me,a as ue,C as R,d as ge,c as y,t as pe,l as fe,m as Ce,n as ve,i as L,u as be,j as Se,k as Re}from"./index.esm-CzniNAqg.js";import{u as w}from"./useMutation-tt7yEThG.js";import{u as F}from"./useQuery-B78dU_LM.js";import{C as k}from"./card-header-s4sK_o_H.js";import{S as Y}from"./simple-grid-6k9JvjOk.js";import{S as I,a as B,b as z,c as E}from"./stat-number-Cmk69z9o.js";import{P as M}from"./progress-L6EjqW44.js";import{M as Z,a as _}from"./modal-footer-B3ZHaos3.js";import{I as ye}from"./image-DYvxu-zB.js";import{F as A,S as Ie}from"./select-C8GCKjda.js";import{F as Q}from"./form-label-DaOodn7p.js";import{S as Be}from"./switch-B-2mnAik.js";import{I as ee}from"./input-BR2M-WI7.js";import"./use-checkbox-CV8AuttE.js";const Pe=()=>{const[se,u]=N.useState(!1),[c,g]=N.useState({autoReconnect:!0,maxReconnectAttempts:5,reconnectInterval:30,logLevel:"info"}),{isOpen:ne,onOpen:re,onClose:W}=ae(),x=le(),j=de(),p=P("white","gray.700"),f=P("gray.200","gray.600"),{data:s,isLoading:ie,error:D}=F("botStatus",h.getBotStatus,{refetchInterval:5e3}),{data:r}=F("botConfig",h.getBotConfig),{data:C,isLoading:O}=F("botQR",h.getBotQR,{enabled:!(s!=null&&s.connected),refetchInterval:s!=null&&s.connected?!1:1e4}),q=w(h.restartBot,{onSuccess:()=>{j.invalidateQueries("botStatus"),x({title:"Bot reiniciado",description:"El bot ha sido reiniciado exitosamente",status:"success"})},onError:i=>{var l,d;x({title:"Error",description:((d=(l=i.response)==null?void 0:l.data)==null?void 0:d.message)||"Error al reiniciar el bot",status:"error"})}}),T=w(h.disconnectBot,{onSuccess:()=>{j.invalidateQueries("botStatus"),x({title:"Bot desconectado",description:"El bot ha sido desconectado exitosamente",status:"success"})},onError:i=>{var l,d;x({title:"Error",description:((d=(l=i.response)==null?void 0:l.data)==null?void 0:d.message)||"Error al desconectar el bot",status:"error"})}}),H=w(h.updateBotConfig,{onSuccess:()=>{j.invalidateQueries("botConfig"),x({title:"Configuración actualizada",description:"La configuración del bot ha sido actualizada",status:"success"}),u(!1)},onError:i=>{var l,d;x({title:"Error",description:((d=(l=i.response)==null?void 0:l.data)==null?void 0:d.message)||"Error al actualizar configuración",status:"error"})}}),oe=()=>{window.confirm("¿Estás seguro de que quieres reiniciar el bot?")&&q.mutate()},ce=()=>{window.confirm("¿Estás seguro de que quieres desconectar el bot?")&&T.mutate()},te=()=>{H.mutate(c)},v=s!=null&&s.connected?{status:"success",text:"Conectado",icon:Se}:s!=null&&s.connecting?{status:"warning",text:"Conectando...",icon:L}:{status:"error",text:"Desconectado",icon:Re};return D?e.jsxs(V,{status:"error",children:[e.jsx(G,{}),"Error al cargar el estado del bot: ",D.message]}):e.jsxs(t,{children:[e.jsxs(m,{spacing:6,align:"stretch",children:[e.jsxs(xe,{align:"center",justify:"space-between",children:[e.jsxs(t,{children:[e.jsx(b,{size:"lg",children:"Estado del Bot"}),e.jsx(n,{color:"gray.600",mt:1,children:"Monitoreo y control del bot de WhatsApp"})]}),e.jsxs(o,{spacing:3,children:[e.jsx(a,{leftIcon:e.jsx(me,{}),colorScheme:"blue",variant:"outline",onClick:re,isDisabled:s==null?void 0:s.connected,children:"Ver QR"}),e.jsx(a,{leftIcon:e.jsx(ue,{}),colorScheme:"gray",variant:"outline",onClick:()=>u(!0),children:"Configuración"})]})]}),e.jsxs(R,{bg:p,border:"1px",borderColor:f,children:[e.jsx(k,{children:e.jsxs(o,{children:[e.jsx(S,{as:ge,color:"green.500"}),e.jsx(b,{size:"md",children:"Estado de Conexión"})]})}),e.jsxs(y,{children:[e.jsxs(Y,{columns:{base:1,md:2,lg:4},spacing:6,children:[e.jsxs(I,{children:[e.jsx(B,{children:"Estado"}),e.jsx(z,{children:e.jsxs(o,{children:[e.jsx(S,{as:v.icon,color:`${v.status}.500`}),e.jsx(n,{color:`${v.status}.400`,children:v.text})]})}),e.jsx(E,{children:s!=null&&s.connected?"Bot funcionando correctamente":"Bot no está conectado"})]}),e.jsxs(I,{children:[e.jsx(B,{children:"Número de Teléfono"}),e.jsx(z,{fontSize:"lg",children:(s==null?void 0:s.phone)||"No disponible"}),e.jsxs(E,{children:[e.jsx(S,{as:pe,mr:1}),"WhatsApp conectado"]})]}),e.jsxs(I,{children:[e.jsx(B,{children:"Tiempo Activo"}),e.jsx(z,{children:(s==null?void 0:s.uptime)||"0h 0m"}),e.jsxs(E,{children:[e.jsx(S,{as:fe,mr:1}),"Uptime del bot"]})]}),e.jsxs(I,{children:[e.jsx(B,{children:"Última Actividad"}),e.jsx(z,{fontSize:"sm",children:s!=null&&s.lastSeen?new Date(s.lastSeen).toLocaleString():"N/A"}),e.jsx(E,{children:"Última vez activo"})]})]}),e.jsx(he,{my:6}),e.jsxs(o,{spacing:4,justify:"center",children:[e.jsx(a,{leftIcon:e.jsx(Ce,{}),colorScheme:"green",size:"lg",onClick:oe,isLoading:q.isLoading,isDisabled:!(s!=null&&s.connected),children:"Reiniciar Bot"}),e.jsx(a,{leftIcon:e.jsx(ve,{}),colorScheme:"red",variant:"outline",size:"lg",onClick:ce,isLoading:T.isLoading,isDisabled:!(s!=null&&s.connected),children:"Desconectar Bot"}),e.jsx(a,{leftIcon:e.jsx(L,{}),colorScheme:"blue",variant:"outline",size:"lg",onClick:()=>j.invalidateQueries("botStatus"),isLoading:ie,children:"Actualizar"})]})]})]}),e.jsxs(Y,{columns:{base:1,lg:2},spacing:6,children:[e.jsxs(R,{bg:p,border:"1px",borderColor:f,children:[e.jsx(k,{children:e.jsx(b,{size:"md",children:"Configuración Actual"})}),e.jsx(y,{children:e.jsxs(m,{spacing:4,align:"stretch",children:[e.jsxs(o,{justify:"space-between",children:[e.jsx(n,{children:"Auto Reconexión"}),e.jsx($,{colorScheme:r!=null&&r.autoReconnect?"green":"red",children:r!=null&&r.autoReconnect?"Activada":"Desactivada"})]}),e.jsxs(o,{justify:"space-between",children:[e.jsx(n,{children:"Intentos de Reconexión"}),e.jsx(n,{fontWeight:"semibold",children:(r==null?void 0:r.maxReconnectAttempts)||5})]}),e.jsxs(o,{justify:"space-between",children:[e.jsx(n,{children:"Intervalo de Reconexión"}),e.jsxs(n,{fontWeight:"semibold",children:[(r==null?void 0:r.reconnectInterval)||30,"s"]})]}),e.jsxs(o,{justify:"space-between",children:[e.jsx(n,{children:"Nivel de Log"}),e.jsx($,{colorScheme:"blue",children:(r==null?void 0:r.logLevel)||"info"})]})]})})]}),e.jsxs(R,{bg:p,border:"1px",borderColor:f,children:[e.jsx(k,{children:e.jsx(b,{size:"md",children:"Estadísticas de Conexión"})}),e.jsx(y,{children:e.jsxs(m,{spacing:4,align:"stretch",children:[e.jsxs(t,{children:[e.jsxs(o,{justify:"space-between",mb:2,children:[e.jsx(n,{fontSize:"sm",children:"Estabilidad de Conexión"}),e.jsx(n,{fontSize:"sm",fontWeight:"semibold",children:"85%"})]}),e.jsx(M,{value:85,colorScheme:"green"})]}),e.jsxs(t,{children:[e.jsxs(o,{justify:"space-between",mb:2,children:[e.jsx(n,{fontSize:"sm",children:"Tiempo de Respuesta"}),e.jsx(n,{fontSize:"sm",fontWeight:"semibold",children:"120ms"})]}),e.jsx(M,{value:75,colorScheme:"blue"})]}),e.jsxs(t,{children:[e.jsxs(o,{justify:"space-between",mb:2,children:[e.jsx(n,{fontSize:"sm",children:"Mensajes Procesados"}),e.jsx(n,{fontSize:"sm",fontWeight:"semibold",children:"1,234"})]}),e.jsx(M,{value:90,colorScheme:"purple"})]})]})})]})]}),!(s!=null&&s.connected)&&e.jsx(R,{bg:p,border:"1px",borderColor:f,children:e.jsx(y,{children:e.jsxs(V,{status:"warning",children:[e.jsx(G,{}),e.jsxs(t,{children:[e.jsx(n,{fontWeight:"semibold",children:"Bot desconectado"}),e.jsx(n,{fontSize:"sm",children:"El bot no está conectado. Escanea el código QR para conectarlo a WhatsApp."})]})]})})})]}),e.jsxs(U,{isOpen:ne,onClose:W,size:"md",children:[e.jsx(J,{}),e.jsxs(Z,{children:[e.jsx(K,{children:"Conectar Bot a WhatsApp"}),e.jsx(X,{children:e.jsxs(m,{spacing:4,children:[e.jsx(n,{textAlign:"center",color:"gray.600",children:"Escanea este código QR con tu WhatsApp para conectar el bot"}),O?e.jsxs(t,{textAlign:"center",py:8,children:[e.jsx(je,{size:"xl"}),e.jsx(n,{mt:4,children:"Generando código QR..."})]}):C!=null&&C.qr?e.jsx(t,{textAlign:"center",children:e.jsx(ye,{src:`data:image/png;base64,${C.qr}`,alt:"QR Code",maxW:"300px",mx:"auto"})}):e.jsxs(t,{textAlign:"center",py:8,children:[e.jsx(n,{color:"red.500",children:"Error al generar el código QR"}),e.jsx(n,{fontSize:"sm",color:"gray.500",mt:2,children:"Intenta cerrar y abrir este modal nuevamente"})]}),e.jsx(n,{fontSize:"sm",color:"gray.500",textAlign:"center",children:"El código QR se actualiza automáticamente cada 10 segundos"})]})}),e.jsxs(_,{children:[e.jsx(a,{leftIcon:e.jsx(L,{}),onClick:()=>j.invalidateQueries("botQR"),isLoading:O,mr:3,children:"Refrescar QR"}),e.jsx(a,{onClick:W,children:"Cerrar"})]})]})]}),e.jsxs(U,{isOpen:se,onClose:()=>u(!1),size:"lg",children:[e.jsx(J,{}),e.jsxs(Z,{children:[e.jsx(K,{children:"Configuración del Bot"}),e.jsx(X,{children:e.jsxs(m,{spacing:4,children:[e.jsxs(A,{display:"flex",alignItems:"center",children:[e.jsx(Q,{mb:"0",children:e.jsxs(o,{children:[e.jsx(be,{}),e.jsx(n,{children:"Auto Reconexión"})]})}),e.jsx(Be,{isChecked:c.autoReconnect,onChange:i=>g({...c,autoReconnect:i.target.checked}),colorScheme:"green"})]}),e.jsxs(A,{children:[e.jsx(Q,{children:"Intentos de Reconexión"}),e.jsx(ee,{type:"number",value:c.maxReconnectAttempts,onChange:i=>g({...c,maxReconnectAttempts:parseInt(i.target.value)}),min:1,max:10})]}),e.jsxs(A,{children:[e.jsx(Q,{children:"Intervalo de Reconexión (segundos)"}),e.jsx(ee,{type:"number",value:c.reconnectInterval,onChange:i=>g({...c,reconnectInterval:parseInt(i.target.value)}),min:5,max:300})]}),e.jsxs(A,{children:[e.jsx(Q,{children:"Nivel de Log"}),e.jsxs(Ie,{value:c.logLevel,onChange:i=>g({...c,logLevel:i.target.value}),children:[e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"warn",children:"Warning"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"debug",children:"Debug"})]})]})]})}),e.jsxs(_,{children:[e.jsx(a,{variant:"ghost",mr:3,onClick:()=>u(!1),children:"Cancelar"}),e.jsx(a,{colorScheme:"blue",onClick:te,isLoading:H.isLoading,children:"Guardar Configuración"})]})]})]})]})};export{Pe as BotStatus,Pe as default};
//# sourceMappingURL=BotStatus-DdvyB2va.js.map
