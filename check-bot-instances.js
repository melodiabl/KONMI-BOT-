// Script para verificar instancias del bot
import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

async function checkBotInstances() {
  try {
    console.log('üîç Verificando instancias del bot...');
    
    // En Windows, buscar procesos node que contengan "index.js"
    const { stdout } = await execAsync('tasklist /FI "IMAGENAME eq node.exe" /FO CSV');
    
    const lines = stdout.split('\n').filter(line => line.includes('node.exe'));
    
    if (lines.length > 1) {
      console.log(`‚ö†Ô∏è Se encontraron ${lines.length} procesos node.exe ejecut√°ndose:`);
      lines.forEach((line, index) => {
        console.log(`   ${index + 1}. ${line.trim()}`);
      });
      
      console.log('\nüîß Recomendaciones:');
      console.log('1. Detener todos los procesos: Get-Process | Where-Object {$_.ProcessName -like "*node*"} | Stop-Process -Force');
      console.log('2. Reiniciar solo una instancia del bot');
      console.log('3. Verificar que no haya scripts de auto-reinicio ejecut√°ndose');
    } else {
      console.log('‚úÖ Solo hay una instancia del bot ejecut√°ndose');
    }
    
    // Verificar puertos en uso
    console.log('\nüîç Verificando puertos en uso...');
    const { stdout: netstat } = await execAsync('netstat -ano | findstr :3001');
    
    if (netstat) {
      console.log('üì° Puerto 3001 en uso:');
      console.log(netstat);
    } else {
      console.log('‚úÖ Puerto 3001 libre');
    }
    
  } catch (error) {
    console.error('‚ùå Error verificando instancias:', error.message);
  }
}

checkBotInstances();

